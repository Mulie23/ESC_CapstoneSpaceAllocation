<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Capstone Allocation Web Application</title>
    <link rel="stylesheet" href="Capstone_Allocation.css">
    <link rel="stylesheet" href="jquery-ui.min.css">
    <link rel="stylesheet" type="text/css"
        href="file:///C:/Users/shinj/Desktop/2dpacking/Base%20GUI/fontawesome-free-5.12.1-web/css/all.css">
    <script src="jquery.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="../bin-pack.js"></script>
    <script src="../datacleaner.js"></script>
    <script src="../combine/ui.js"></script>
    <link rel="stylesheet" href="../combine/style.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>

    <script src="https://daybrush.com/moveable/release/latest/dist/moveable.min.js"></script>
    <script src="https://daybrush.com/scenejs/release/latest/dist/scene.js"></script>
</head>

<body>
    <header>Capstone Allocation</header>
    <section>
        <nav>
            <input type="file" id="uploaded-file" class="hidden" accept="image/*">
            <label for="uploaded-file">Upload Image</label>
            <br>
            <input type="file" id="uploaded-excel" class="hidden"
                accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-exce">
            <label for="uploaded-excel" id="upload" onclick="Upload()">Upload Excel</label>
            <div id="excel-name"></div>
            <br>
            <div class="btn-group">
                <button id="drawBtn" onclick="draw()">Draw</button>
                <br>
                <button id="editBtn" onclick="resize()">Edit</button>
                <br>
                <button id="runBtn" onclick="Run()">Run</button>
                <br>
                <button id="save-button">Save Image</button>
            </div>
            <p id='error-message'></p>
        </nav>

        <article id="drawZone">
            <div id="buttonContainer" style="position: absolute; right: 0;">
                <button type=" button" class="zoomBtnIn" onclick="zoomin()" id="zoomIn"><i
                        class="fas fa-search-plus"></i></button>
                <button type="button" class="zoomBtnOut" onclick="zoomout()" id="zoomOut"><i
                        class="fas fa-search-minus"></i></button>
            </div>
            <div id="container" style="width: 100%; height: 100%; background-color: aqua; overflow: visible;">
                <canvas id="our-canvas" z-index="1"></canvas>
            </div>
            <script src="../rotate_daybrush/rotate.js"></script>
        </article>
    </section>
    <div id="dvExcel">dvExcel</div>
</body>

<script type="text/javascript">
    // script to handle zooming in and out of canvas
    function zoomin() {
        var GFG = document.getElementById("our-canvas");
        var currentHeight = GFG.clientHeight;
        GFG.style.height = (currentHeight + 150) + "px";
    }

    function zoomout() {
        var GFG = document.getElementById("our-canvas");
        var currentHeight = GFG.clientHeight;
        GFG.style.height = (currentHeight - 150) + "px";
    }

    // script to enable drag-moving of canvas
    $("#container").draggable();
    // script to handle uploading of image file
    var canvas = document.getElementById('our-canvas');
    var context = canvas.getContext('2d');

    window.addEventListener('DOMContentLoaded', initImageLoader);

    var uploadedFile = document.getElementById('uploaded-file');

    function initImageLoader() {
        uploadedFile.addEventListener('change', handleManualUploadedFiles);

        function handleManualUploadedFiles(ev) {
            var file = ev.target.files[0];
            handleFile(file);
        }
    }

    function handleFile(file) {
        var imageType = /image.*/;

        if (file.type.match(imageType)) {
            var reader = new FileReader();

            reader.onloadend = function (event) {
                var tempImageStore = new Image();
                tempImageStore.onload = function (ev) {
                    canvas.width = ev.target.width;
                    canvas.height = ev.target.height;
                    context.drawImage(ev.target, 0, 0);
                }
                tempImageStore.src = event.target.result;
            }

            reader.readAsDataURL(file);
        }
        else {
            var error = document.getElementById('error-message');
            error.innerHTML = "Error! You did not upload an image file! (eg .png, .jpg)";
        }
    }

    // script to handle uploading of excel file
    var input = document.getElementById("uploaded-excel");
    var infoArea = document.getElementById("excel-name");

    input.addEventListener('change', showFileName);

    function showFileName(event) {
        var input = event.srcElement;
        var fileName = input.files[0].name;
        infoArea.textContent = fileName;
    }

    // script to handle saving of canvas into image 
    var saveButton = document.getElementById("save-button");
    var canvas = document.getElementById("our-canvas");
    var context = canvas.getContext('2d');

    saveButton.addEventListener("click", function () {
        //for IE / Edge
        if (window.navigator.msSaveBlob) {
            window.navigator.msSaveBlob(canvas.msToBlob(), "canvas-image.png");
        }
        else {
            //for google chrome, firefox & other web browser downloads
            var a = document.createElement("a");
            document.body.appendChild(a);
            a.href = canvas.toDataURL();
            a.download = "canvas-image.png"
            a.click();
            document.body.removeChild(a);
        }
    })

</script>

</html>